# Ignite - Supabase Self-Hosting Setup

This setup provides a complete self-hosted Supabase instance for your team's development needs using the Supabase CLI.

## Prerequisites

### Required Software

1. **Docker Desktop**
   - Download from https://www.docker.com/products/docker-desktop/
   - Install with WSL 2 integration enabled (Windows users)
   - Ensure Docker is running

2. **Git** - For cloning the repository

3. **Node.js 18+** - For local development (optional)

### WSL 2 Setup (Windows Users Only)

1. Install Docker Desktop for Windows
2. Open Docker Desktop Settings → Resources → WSL Integration  
3. Enable integration with your WSL distro
4. Click "Apply & Restart"

## Quick Start

### 1. Clone the Repository
```bash
git clone <your-repo-url>
cd ignite
```

### 2. Install Supabase CLI

**Linux/WSL:**
```bash
curl -L https://github.com/supabase/cli/releases/download/v1.200.3/supabase_linux_amd64.tar.gz | tar -xz
sudo mv supabase /usr/local/bin/
```

**macOS:**
```bash
brew install supabase/tap/supabase
```

**Windows:**
```bash
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase
```

### 3. Start Supabase

```bash
# This will download all Docker images and start Supabase
supabase start
```

**⏳ First run takes 5-10 minutes** to download all Docker images.

### 4. Access Your Services

Once started, you'll see output like this:
```
         API URL: http://127.0.0.1:54321
      Studio URL: http://127.0.0.1:54323
          DB URL: postgresql://postgres:postgres@127.0.0.1:54322/postgres
        anon key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
service_role key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Access Points

- **🎨 Supabase Studio**: http://localhost:54323 (Database GUI)
- **🔌 Supabase API**: http://localhost:54321 (REST/GraphQL)
- **💾 Database**: postgresql://postgres:postgres@localhost:54322/postgres
- **📧 Email Testing**: http://localhost:54324 (Inbucket)

## Database Schema

Your database includes:

### Tables Created
- **programs** - Engineering, Computer Science, Business, etc. (7 programs)
- **majors** - 24 majors linked to programs  
- **profiles** - User profiles with education info, career details, bio
- **connections** - User networking (pending/accepted/declined)
- **admin_posts** - Content management (public/members/private)
- **membership_allowlist** - Email and ZID validation for signups
- **audit_log** - Activity tracking for security

### Sample Data Included
- 7 programs with 24 majors (Engineering, CS, Business, Medicine, Law, Arts, Science)
- Sample user profiles
- Example connections
- Admin posts with different visibility levels
- Membership allowlist entries

## Development Workflow

### Environment Setup

Your `.env` files are already configured with the correct API keys:

**Frontend (.env):**
```bash
VITE_SUPABASE_URL=http://localhost:54321
VITE_SUPABASE_ANON_KEY=[generated by supabase start]
```

**Backend (.env):**
```bash
PORT=8000
SUPABASE_URL=http://localhost:54321
SUPABASE_ANON_KEY=[generated by supabase start]
SUPABASE_SERVICE_KEY=[generated by supabase start]
```

> 🔑 **API Keys**: The actual keys will be generated when you run `supabase start` and are already configured in your local `.env` files.

### Local Development

1. **Frontend Development:**
   ```bash
   cd frontend
   npm install
   npm run dev
   # Frontend runs on http://localhost:3000
   ```

2. **Backend Development:**
   ```bash
   cd backend
   npm install
   npm run dev
   # Backend runs on http://localhost:8000
   ```

### Database Management

1. **View/Edit Data:**
   - Use Supabase Studio: http://localhost:54323
   - No login required for local development

2. **Database Migrations:**
   - Migrations are in `supabase/migrations/`
   - Apply migrations: `supabase db reset`
   - Create new migration: `supabase migration new <name>`

## Useful Commands

### Supabase Management
```bash
# Start Supabase services
supabase start

# Stop Supabase services
supabase stop

# Check status and get connection details
supabase status

# Reset database (apply all migrations and seed data)
supabase db reset

# Create a new migration
supabase migration new <migration_name>

# Generate TypeScript types from database
supabase gen types typescript --local > types/supabase.ts
```

### Database Management
```bash
# Connect to database directly
docker exec supabase_db_ignite psql -U postgres -d postgres

# View specific table data
docker exec supabase_db_ignite psql -U postgres -d postgres -c "SELECT * FROM programs;"

# Check all tables
docker exec supabase_db_ignite psql -U postgres -d postgres -c "\\dt"
```

## Troubleshooting

### Common Issues

1. **"Docker not found" error:**
   - Install Docker Desktop
   - Enable WSL 2 integration (Windows)
   - Ensure Docker is running

2. **Services not starting:**
   ```bash
   supabase stop
   supabase start
   ```

3. **Port conflicts:**
   - The default ports are 54321 (API), 54322 (DB), 54323 (Studio)
   - Change ports in `supabase/config.toml` if needed

4. **Database connection issues:**
   ```bash
   supabase status  # Check if services are running
   supabase db reset  # Reset database if corrupted
   ```

5. **Migration errors:**
   ```bash
   supabase db reset  # This will reapply all migrations
   ```

### Getting Help

1. Check Supabase docs: https://supabase.com/docs
2. Check service logs: `docker logs supabase_db_ignite`
3. Restart everything: `supabase stop && supabase start`

## Security Notes

⚠️ **This setup is for development only!**

- Uses demo JWT secrets and keys for convenience
- All RLS policies are simplified for development
- In production, implement proper authentication and authorization
- The demo keys are from official Supabase documentation

## Next Steps

### For Team Development

1. **Share this repository** with your teammates
2. **Each team member** should follow the Quick Start guide
3. **Everyone will have** the same database schema and API keys
4. **Start building** your Ignite application!

### Project Structure

```
ignite/
├── supabase/
│   ├── config.toml          # Supabase configuration
│   ├── migrations/          # Database schema migrations
│   └── seed.sql            # Sample data
├── frontend/
│   ├── .env                # Frontend API keys (configured)
│   └── src/lib/supabase.ts # Supabase client setup
├── backend/
│   └── .env                # Backend API keys (configured)
└── SETUP.md                # This file
```

## Architecture Overview

```
┌─────────────────┐    ┌─────────────────┐
│    Frontend     │    │     Backend     │
│   (React/Vite)  │    │   (Node.js)     │
│   Port: 3000    │    │   Port: 8000    │
└─────────────────┘    └─────────────────┘
         │                       │
         └───────────┬───────────┘
                     │
         ┌─────────────────┐
         │   Supabase      │
         │  (Local Stack)  │
         │   Port: 54321   │
         └─────────────────┘
                     │
    ┌────────────────┼────────────────┐
    │                │                │
┌───▼───┐    ┌───────▼──┐    ┌────▼───┐
│  Auth │    │PostgreSQL│    │Storage │
│       │    │Port: 54322│    │        │
└───────┘    └──────────┘    └────────┘
```

---

## 🚀 Ready to Build!

Your Ignite platform is now ready for development. All team members can work with the same database schema and API endpoints locally.

**Happy coding!** ✨